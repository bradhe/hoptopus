<% content_for :title do %>
  hoptopus: the easy way to track and share what's in you beer cellar
<% end %>

<h2>The easy way to track and share what's in your beer cellar.</h2>

<div class="the-hoptopus"><img src="/images/thehoptopus.png" /></div>

<div class="more-info">
    <h2 class="tag">Hoptopus makes it easy for you to get the most out of your beer cellar!</h2>

    <ul>
      <li>Track your beer collection.</li>
      <li>Share tasting and aging notes.</li>
      <li>Track where your beers are in the aging process.</li>
      <li>Discover new beers with recomendations and reviews from other users.</li>
    </ul>

    <div class="signup">
      <h3>Create Your Free Hoptopus Account</h3>
        <% form_for(User.new, :url => register_path) do |f| %>
          <%= f.hidden_field :email_consent, :value => true %>

          <div class="field">
            <%= f.label :username, "Username:" %>
            <%= f.text_field :username %>
          </div>

          <div class="field">
            <%= f.label :email, "Email Address:" %>
            <%= f.email_field :email %>
          </div>

          <div class="field">
            <%= f.label :password, "Password:" %>
            <%= f.password_field :password %>
          </div>

          <div class="buttons">
            <%= submit_tag 'Register' %>
          </div>
        <% end %>
    </div>
</div>

<div class="newsletter">
  <span class="note">Sign up for the hoptopus newsletter!</span>

  <div class="wrapper">
    <input type="text" name="email" id="email" /> <button type="button" id="signup">Signup</button>
  </div>
</div>

<% content_for :javascript do %>
<script type="text/javascript">
var progressImg = new Image();
progressImg.src = '/images/progress-small.gif';

$(function() {
  $('#signup').bind('click', function() {
    var emailInput = $('#email');

    if(emailInput.isEmpty()) {
      return;
    }

    var wrapper = $(this).parents('.wrapper');
    var parent = wrapper.parent();

    // Post this back to the server.
    wrapper.fadeOut('fast', function() {
      $(progressImg).hide();
      $(progressImg).appendTo(parent);
      $(progressImg).fadeIn('fast', function() {
        $.ajax({
          url: '<%= newsletter_signup_path %>',
          data: { email: emailInput.val() },
          type: 'POST',
          error: function(data) {
            $(progressImg).fadeOut('fast', function() { wrapper.fadeIn('fast'); });
            var errors = JSON.parse(data.responseText);
            var span = $('<span/>').addClass('error').text(errors.message.email);
            wrapper.append(span);

            $('#signup').click(function() { span.fadeOut('fast', function() { $(this).remove(); }) });
            $('#email').keypress(function() { span.fadeOut('fast', function() { $(this).remove(); }) });
          },
          success: function(data) {
            $(progressImg).fadeOut('fast', function() {
              var span = $('<span/>').addClass('note').text('Hurray! Thanks for signing up.');
              span.appendTo(parent);
              span.fadeIn('fast');
            });
          }
        });
      });
    });
  });
});
</script>
<% end %>
